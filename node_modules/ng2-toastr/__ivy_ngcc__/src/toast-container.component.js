"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var toast_options_1 = require("./toast-options");
var platform_browser_1 = require("@angular/platform-browser");
require("rxjs/add/operator/first");
var Subject_1 = require("rxjs/Subject");
var ɵngcc0 = require('@angular/core');
var ɵngcc1 = require('@angular/platform-browser');
var ɵngcc2 = require('./toast-options');
var ɵngcc3 = require('@angular/common');

function ToastContainer_div_2_div_1_Template(rf, ctx) { if (rf & 1) {
    var _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵlistener("click", function ToastContainer_div_2_div_1_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); var toast_r2 = ɵngcc0.ɵɵnextContext().$implicit; var ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.removeToast(toast_r2); });
    ɵngcc0.ɵɵtext(1, "\u00D7 ");
    ɵngcc0.ɵɵelementEnd();
} }
function ToastContainer_div_2_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var toast_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    var ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMap(toast_r2.config.titleClass || ctx_r4.titleClass);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(toast_r2.title);
} }
function ToastContainer_div_2_span_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "span", 10);
} if (rf & 2) {
    var toast_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    var ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMap(toast_r2.config.messageClass || ctx_r5.messageClass);
    ɵngcc0.ɵɵproperty("innerHTML", ctx_r5.sanitizer.bypassSecurityTrustHtml(toast_r2.message), ɵngcc0.ɵɵsanitizeHtml);
} }
function ToastContainer_div_2_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var toast_r2 = ɵngcc0.ɵɵnextContext().$implicit;
    var ctx_r6 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMap(toast_r2.config.messageClass || ctx_r6.messageClass);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(toast_r2.message);
} }
function ToastContainer_div_2_Template(rf, ctx) { if (rf & 1) {
    var _r14 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵlistener("@inOut.done", function ToastContainer_div_2_Template_div_animation_inOut_done_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r14); var ctx_r13 = ɵngcc0.ɵɵnextContext(); return ctx_r13.onAnimationEnd($event); })("click", function ToastContainer_div_2_Template_div_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r14); var toast_r2 = ctx.$implicit; var ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.clicked(toast_r2); });
    ɵngcc0.ɵɵtemplate(1, ToastContainer_div_2_div_1_Template, 2, 0, "div", 4);
    ɵngcc0.ɵɵtemplate(2, ToastContainer_div_2_div_2_Template, 2, 4, "div", 5);
    ɵngcc0.ɵɵelementStart(3, "div", 6);
    ɵngcc0.ɵɵtemplate(4, ToastContainer_div_2_span_4_Template, 1, 4, "span", 7);
    ɵngcc0.ɵɵtemplate(5, ToastContainer_div_2_span_5_Template, 2, 4, "span", 8);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var toast_r2 = ctx.$implicit;
    var ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassMapInterpolate1("toast toast-", toast_r2.type, "");
    ɵngcc0.ɵɵproperty("@inOut", ctx_r1.animate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", toast_r2.config.showCloseButton);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", toast_r2.title);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngSwitch", toast_r2.config.enableHTML);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngSwitchCase", true);
} }
var ToastContainer = (function () {
    function ToastContainer(sanitizer, cdr, _zone, options) {
        this.sanitizer = sanitizer;
        this.cdr = cdr;
        this._zone = _zone;
        this.position = 'fixed';
        this.toasts = [];
        this._fresh = true;
        this._onEnter = new Subject_1.Subject();
        this._onExit = new Subject_1.Subject();
        Object.assign(this, options);
    }
    ToastContainer.prototype.onEnter = function () {
        return this._onEnter.asObservable();
    };
    ToastContainer.prototype.onExit = function () {
        return this._onExit.asObservable();
    };
    ToastContainer.prototype.addToast = function (toast) {
        if (this.positionClass.indexOf('top') > 0) {
            if (this.newestOnTop) {
                this.toasts.unshift(toast);
            }
            else {
                this.toasts.push(toast);
            }
            if (this.toasts.length > this.maxShown) {
                var diff = this.toasts.length - this.maxShown;
                if (this.newestOnTop) {
                    this.toasts.splice(this.maxShown);
                }
                else {
                    this.toasts.splice(0, diff);
                }
            }
        }
        else {
            this.toasts.unshift(toast);
            if (this.toasts.length > this.maxShown) {
                this.toasts.splice(this.maxShown);
            }
        }
        if (this.animate === null && this._fresh) {
            this._fresh = false;
            this._onEnter.next();
            this._onEnter.complete();
        }
        this.cdr.detectChanges();
    };
    ToastContainer.prototype.removeToast = function (toast) {
        if (toast.timeoutId) {
            clearTimeout(toast.timeoutId);
            toast.timeoutId = null;
        }
        this.toasts = this.toasts.filter(function (t) {
            return t.id !== toast.id;
        });
    };
    ToastContainer.prototype.removeAllToasts = function () {
        this.toasts = [];
    };
    ToastContainer.prototype.clicked = function (toast) {
        if (this.onToastClicked) {
            this.onToastClicked(toast);
        }
    };
    ToastContainer.prototype.anyToast = function () {
        return this.toasts.length > 0;
    };
    ToastContainer.prototype.findToast = function (toastId) {
        for (var _i = 0, _a = this.toasts; _i < _a.length; _i++) {
            var toast = _a[_i];
            if (toast.id === toastId) {
                return toast;
            }
        }
        return null;
    };
    ToastContainer.prototype.onAnimationEnd = function (event) {
        var _this = this;
        if (event.toState === 'void' && !this.anyToast()) {
            this._ngExit();
        }
        else if (this._fresh && event.fromState === 'void') {
            // notify when first animation is done
            this._fresh = false;
            this._zone.run(function () {
                _this._onEnter.next();
                _this._onEnter.complete();
            });
        }
    };
    ToastContainer.prototype._ngExit = function () {
        var _this = this;
        this._zone.onMicrotaskEmpty.first().subscribe(function () {
            _this._onExit.next();
            _this._onExit.complete();
        });
    };
    ToastContainer.prototype.ngOnDestroy = function () {
        this._ngExit();
    };
ToastContainer.ɵfac = function ToastContainer_Factory(t) { return new (t || ToastContainer)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DomSanitizer), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ToastOptions)); };
ToastContainer.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ToastContainer, selectors: [["toast-container"]], decls: 3, vars: 6, consts: [["id", "toast-container"], ["toastContainer", ""], [3, "class", "click", 4, "ngFor", "ngForOf"], [3, "click"], ["class", "toast-close-button", 3, "click", 4, "ngIf"], [3, "class", 4, "ngIf"], [3, "ngSwitch"], [3, "class", "innerHTML", 4, "ngSwitchCase"], [3, "class", 4, "ngSwitchDefault"], [1, "toast-close-button", 3, "click"], [3, "innerHTML"]], template: function ToastContainer_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0, 1);
        ɵngcc0.ɵɵtemplate(2, ToastContainer_div_2_Template, 6, 8, "div", 2);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵclassMap(ctx.positionClass);
        ɵngcc0.ɵɵstyleProp("position", ctx.position);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.toasts);
    } }, directives: [ɵngcc3.NgForOf, ɵngcc3.NgIf, ɵngcc3.NgSwitch, ɵngcc3.NgSwitchCase, ɵngcc3.NgSwitchDefault], encapsulation: 2, data: { animation: [
            core_1.trigger('inOut', [
                core_1.state('flyRight, flyLeft', core_1.style({ opacity: 1, transform: 'translateX(0)' })),
                core_1.state('fade', core_1.style({ opacity: 1 })),
                core_1.state('slideDown, slideUp', core_1.style({ opacity: 1, transform: 'translateY(0)' })),
                core_1.transition('void => flyRight', [
                    core_1.style({
                        opacity: 0,
                        transform: 'translateX(100%)'
                    }),
                    core_1.animate('0.2s ease-in')
                ]),
                core_1.transition('flyRight => void', [
                    core_1.animate('0.2s 10ms ease-out', core_1.style({
                        opacity: 0,
                        transform: 'translateX(100%)'
                    }))
                ]),
                core_1.transition('void => flyLeft', [
                    core_1.style({
                        opacity: 0,
                        transform: 'translateX(-100%)'
                    }),
                    core_1.animate('0.2s ease-in')
                ]),
                core_1.transition('flyLeft => void', [
                    core_1.animate('0.2s 10ms ease-out', core_1.style({
                        opacity: 0,
                        transform: 'translateX(-100%)'
                    }))
                ]),
                core_1.transition('void => fade', [
                    core_1.style({
                        opacity: 0
                    }),
                    core_1.animate('0.3s ease-in')
                ]),
                core_1.transition('fade => void', [
                    core_1.animate('0.3s 10ms ease-out', core_1.style({
                        opacity: 0
                    }))
                ]),
                core_1.transition('void => slideDown', [
                    core_1.style({
                        opacity: 0,
                        transform: 'translateY(-200%)'
                    }),
                    core_1.animate('0.3s ease-in')
                ]),
                core_1.transition('slideDown => void', [
                    core_1.animate('0.3s 10ms ease-out', core_1.style({
                        opacity: 0,
                        transform: 'translateY(-200%)'
                    }))
                ]),
                core_1.transition('void => slideUp', [
                    core_1.style({
                        opacity: 0,
                        transform: 'translateY(200%)'
                    }),
                    core_1.animate('0.3s ease-in')
                ]),
                core_1.transition('slideUp => void', [
                    core_1.animate('0.3s 10ms ease-out', core_1.style({
                        opacity: 0,
                        transform: 'translateY(200%)'
                    }))
                ]),
            ]),
        ] } });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ToastContainer, [{
        type: core_1.Component,
        args: [{
                selector: 'toast-container',
                template: "\n    <div #toastContainer id=\"toast-container\" [style.position]=\"position\" class=\"{{positionClass}}\">\n      <div *ngFor=\"let toast of toasts\" [@inOut]=\"animate\" (@inOut.done)=\"onAnimationEnd($event)\" class=\"toast toast-{{toast.type}}\" \n      (click)=\"clicked(toast)\">\n        <div class=\"toast-close-button\" *ngIf=\"toast.config.showCloseButton\" (click)=\"removeToast(toast)\">&times;\n        </div> \n        <div *ngIf=\"toast.title\" class=\"{{toast.config.titleClass || titleClass}}\">{{toast.title}}</div>\n        <div [ngSwitch]=\"toast.config.enableHTML\">\n          <span *ngSwitchCase=\"true\" class=\"{{toast.config.messageClass || messageClass}}\" [innerHTML]=\"sanitizer.bypassSecurityTrustHtml(toast.message)\"></span>\n          <span *ngSwitchDefault class=\"{{toast.config.messageClass || messageClass}}\">{{toast.message}}</span>\n        </div>             \n      </div>\n    </div>\n    ",
                animations: [
                    core_1.trigger('inOut', [
                        core_1.state('flyRight, flyLeft', core_1.style({ opacity: 1, transform: 'translateX(0)' })),
                        core_1.state('fade', core_1.style({ opacity: 1 })),
                        core_1.state('slideDown, slideUp', core_1.style({ opacity: 1, transform: 'translateY(0)' })),
                        core_1.transition('void => flyRight', [
                            core_1.style({
                                opacity: 0,
                                transform: 'translateX(100%)'
                            }),
                            core_1.animate('0.2s ease-in')
                        ]),
                        core_1.transition('flyRight => void', [
                            core_1.animate('0.2s 10ms ease-out', core_1.style({
                                opacity: 0,
                                transform: 'translateX(100%)'
                            }))
                        ]),
                        core_1.transition('void => flyLeft', [
                            core_1.style({
                                opacity: 0,
                                transform: 'translateX(-100%)'
                            }),
                            core_1.animate('0.2s ease-in')
                        ]),
                        core_1.transition('flyLeft => void', [
                            core_1.animate('0.2s 10ms ease-out', core_1.style({
                                opacity: 0,
                                transform: 'translateX(-100%)'
                            }))
                        ]),
                        core_1.transition('void => fade', [
                            core_1.style({
                                opacity: 0
                            }),
                            core_1.animate('0.3s ease-in')
                        ]),
                        core_1.transition('fade => void', [
                            core_1.animate('0.3s 10ms ease-out', core_1.style({
                                opacity: 0
                            }))
                        ]),
                        core_1.transition('void => slideDown', [
                            core_1.style({
                                opacity: 0,
                                transform: 'translateY(-200%)'
                            }),
                            core_1.animate('0.3s ease-in')
                        ]),
                        core_1.transition('slideDown => void', [
                            core_1.animate('0.3s 10ms ease-out', core_1.style({
                                opacity: 0,
                                transform: 'translateY(-200%)'
                            }))
                        ]),
                        core_1.transition('void => slideUp', [
                            core_1.style({
                                opacity: 0,
                                transform: 'translateY(200%)'
                            }),
                            core_1.animate('0.3s ease-in')
                        ]),
                        core_1.transition('slideUp => void', [
                            core_1.animate('0.3s 10ms ease-out', core_1.style({
                                opacity: 0,
                                transform: 'translateY(200%)'
                            }))
                        ]),
                    ]),
                ]
            }]
    }], function () { return [{ type: ɵngcc1.DomSanitizer }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.NgZone }, { type: ɵngcc2.ToastOptions }]; }, null); })();
    return ToastContainer;
}());
/** @nocollapse */
ToastContainer.ctorParameters = function () { return [
    { type: platform_browser_1.DomSanitizer, },
    { type: core_1.ChangeDetectorRef, },
    { type: core_1.NgZone, },
    { type: toast_options_1.ToastOptions, },
]; };
exports.ToastContainer = ToastContainer;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3QtY29udGFpbmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsidG9hc3QtY29udGFpbmVyLmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7eUtBQU07QUFDTjtBQUNBLEtBNEVFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgY29yZV8xID0gcmVxdWlyZShcIkBhbmd1bGFyL2NvcmVcIik7XG52YXIgdG9hc3Rfb3B0aW9uc18xID0gcmVxdWlyZShcIi4vdG9hc3Qtb3B0aW9uc1wiKTtcbnZhciBwbGF0Zm9ybV9icm93c2VyXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3NlclwiKTtcbnJlcXVpcmUoXCJyeGpzL2FkZC9vcGVyYXRvci9maXJzdFwiKTtcbnZhciBTdWJqZWN0XzEgPSByZXF1aXJlKFwicnhqcy9TdWJqZWN0XCIpO1xudmFyIFRvYXN0Q29udGFpbmVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUb2FzdENvbnRhaW5lcihzYW5pdGl6ZXIsIGNkciwgX3pvbmUsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5zYW5pdGl6ZXIgPSBzYW5pdGl6ZXI7XG4gICAgICAgIHRoaXMuY2RyID0gY2RyO1xuICAgICAgICB0aGlzLl96b25lID0gX3pvbmU7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICB0aGlzLnRvYXN0cyA9IFtdO1xuICAgICAgICB0aGlzLl9mcmVzaCA9IHRydWU7XG4gICAgICAgIHRoaXMuX29uRW50ZXIgPSBuZXcgU3ViamVjdF8xLlN1YmplY3QoKTtcbiAgICAgICAgdGhpcy5fb25FeGl0ID0gbmV3IFN1YmplY3RfMS5TdWJqZWN0KCk7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7XG4gICAgfVxuICAgIFRvYXN0Q29udGFpbmVyLnByb3RvdHlwZS5vbkVudGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fb25FbnRlci5hc09ic2VydmFibGUoKTtcbiAgICB9O1xuICAgIFRvYXN0Q29udGFpbmVyLnByb3RvdHlwZS5vbkV4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vbkV4aXQuYXNPYnNlcnZhYmxlKCk7XG4gICAgfTtcbiAgICBUb2FzdENvbnRhaW5lci5wcm90b3R5cGUuYWRkVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgaWYgKHRoaXMucG9zaXRpb25DbGFzcy5pbmRleE9mKCd0b3AnKSA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5ld2VzdE9uVG9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b2FzdHMudW5zaGlmdCh0b2FzdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvYXN0cy5wdXNoKHRvYXN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnRvYXN0cy5sZW5ndGggPiB0aGlzLm1heFNob3duKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRpZmYgPSB0aGlzLnRvYXN0cy5sZW5ndGggLSB0aGlzLm1heFNob3duO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5ld2VzdE9uVG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9hc3RzLnNwbGljZSh0aGlzLm1heFNob3duKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudG9hc3RzLnNwbGljZSgwLCBkaWZmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRvYXN0cy51bnNoaWZ0KHRvYXN0KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnRvYXN0cy5sZW5ndGggPiB0aGlzLm1heFNob3duKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b2FzdHMuc3BsaWNlKHRoaXMubWF4U2hvd24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGUgPT09IG51bGwgJiYgdGhpcy5fZnJlc2gpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZyZXNoID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9vbkVudGVyLm5leHQoKTtcbiAgICAgICAgICAgIHRoaXMuX29uRW50ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfTtcbiAgICBUb2FzdENvbnRhaW5lci5wcm90b3R5cGUucmVtb3ZlVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgaWYgKHRvYXN0LnRpbWVvdXRJZCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRvYXN0LnRpbWVvdXRJZCk7XG4gICAgICAgICAgICB0b2FzdC50aW1lb3V0SWQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudG9hc3RzID0gdGhpcy50b2FzdHMuZmlsdGVyKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdC5pZCAhPT0gdG9hc3QuaWQ7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgVG9hc3RDb250YWluZXIucHJvdG90eXBlLnJlbW92ZUFsbFRvYXN0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50b2FzdHMgPSBbXTtcbiAgICB9O1xuICAgIFRvYXN0Q29udGFpbmVyLnByb3RvdHlwZS5jbGlja2VkID0gZnVuY3Rpb24gKHRvYXN0KSB7XG4gICAgICAgIGlmICh0aGlzLm9uVG9hc3RDbGlja2VkKSB7XG4gICAgICAgICAgICB0aGlzLm9uVG9hc3RDbGlja2VkKHRvYXN0KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RDb250YWluZXIucHJvdG90eXBlLmFueVRvYXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b2FzdHMubGVuZ3RoID4gMDtcbiAgICB9O1xuICAgIFRvYXN0Q29udGFpbmVyLnByb3RvdHlwZS5maW5kVG9hc3QgPSBmdW5jdGlvbiAodG9hc3RJZCkge1xuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy50b2FzdHM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICB2YXIgdG9hc3QgPSBfYVtfaV07XG4gICAgICAgICAgICBpZiAodG9hc3QuaWQgPT09IHRvYXN0SWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9hc3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcbiAgICBUb2FzdENvbnRhaW5lci5wcm90b3R5cGUub25BbmltYXRpb25FbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09ICd2b2lkJyAmJiAhdGhpcy5hbnlUb2FzdCgpKSB7XG4gICAgICAgICAgICB0aGlzLl9uZ0V4aXQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLl9mcmVzaCAmJiBldmVudC5mcm9tU3RhdGUgPT09ICd2b2lkJykge1xuICAgICAgICAgICAgLy8gbm90aWZ5IHdoZW4gZmlyc3QgYW5pbWF0aW9uIGlzIGRvbmVcbiAgICAgICAgICAgIHRoaXMuX2ZyZXNoID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl96b25lLnJ1bihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX29uRW50ZXIubmV4dCgpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9vbkVudGVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RDb250YWluZXIucHJvdG90eXBlLl9uZ0V4aXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3pvbmUub25NaWNyb3Rhc2tFbXB0eS5maXJzdCgpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5fb25FeGl0Lm5leHQoKTtcbiAgICAgICAgICAgIF90aGlzLl9vbkV4aXQuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBUb2FzdENvbnRhaW5lci5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX25nRXhpdCgpO1xuICAgIH07XG4gICAgcmV0dXJuIFRvYXN0Q29udGFpbmVyO1xufSgpKTtcblRvYXN0Q29udGFpbmVyLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBjb3JlXzEuQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAndG9hc3QtY29udGFpbmVyJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogXCJcXG4gICAgPGRpdiAjdG9hc3RDb250YWluZXIgaWQ9XFxcInRvYXN0LWNvbnRhaW5lclxcXCIgW3N0eWxlLnBvc2l0aW9uXT1cXFwicG9zaXRpb25cXFwiIGNsYXNzPVxcXCJ7e3Bvc2l0aW9uQ2xhc3N9fVxcXCI+XFxuICAgICAgPGRpdiAqbmdGb3I9XFxcImxldCB0b2FzdCBvZiB0b2FzdHNcXFwiIFtAaW5PdXRdPVxcXCJhbmltYXRlXFxcIiAoQGluT3V0LmRvbmUpPVxcXCJvbkFuaW1hdGlvbkVuZCgkZXZlbnQpXFxcIiBjbGFzcz1cXFwidG9hc3QgdG9hc3Qte3t0b2FzdC50eXBlfX1cXFwiIFxcbiAgICAgIChjbGljayk9XFxcImNsaWNrZWQodG9hc3QpXFxcIj5cXG4gICAgICAgIDxkaXYgY2xhc3M9XFxcInRvYXN0LWNsb3NlLWJ1dHRvblxcXCIgKm5nSWY9XFxcInRvYXN0LmNvbmZpZy5zaG93Q2xvc2VCdXR0b25cXFwiIChjbGljayk9XFxcInJlbW92ZVRvYXN0KHRvYXN0KVxcXCI+JnRpbWVzO1xcbiAgICAgICAgPC9kaXY+IFxcbiAgICAgICAgPGRpdiAqbmdJZj1cXFwidG9hc3QudGl0bGVcXFwiIGNsYXNzPVxcXCJ7e3RvYXN0LmNvbmZpZy50aXRsZUNsYXNzIHx8IHRpdGxlQ2xhc3N9fVxcXCI+e3t0b2FzdC50aXRsZX19PC9kaXY+XFxuICAgICAgICA8ZGl2IFtuZ1N3aXRjaF09XFxcInRvYXN0LmNvbmZpZy5lbmFibGVIVE1MXFxcIj5cXG4gICAgICAgICAgPHNwYW4gKm5nU3dpdGNoQ2FzZT1cXFwidHJ1ZVxcXCIgY2xhc3M9XFxcInt7dG9hc3QuY29uZmlnLm1lc3NhZ2VDbGFzcyB8fCBtZXNzYWdlQ2xhc3N9fVxcXCIgW2lubmVySFRNTF09XFxcInNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbCh0b2FzdC5tZXNzYWdlKVxcXCI+PC9zcGFuPlxcbiAgICAgICAgICA8c3BhbiAqbmdTd2l0Y2hEZWZhdWx0IGNsYXNzPVxcXCJ7e3RvYXN0LmNvbmZpZy5tZXNzYWdlQ2xhc3MgfHwgbWVzc2FnZUNsYXNzfX1cXFwiPnt7dG9hc3QubWVzc2FnZX19PC9zcGFuPlxcbiAgICAgICAgPC9kaXY+ICAgICAgICAgICAgIFxcbiAgICAgIDwvZGl2PlxcbiAgICA8L2Rpdj5cXG4gICAgXCIsXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICBjb3JlXzEudHJpZ2dlcignaW5PdXQnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuc3RhdGUoJ2ZseVJpZ2h0LCBmbHlMZWZ0JywgY29yZV8xLnN0eWxlKHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwKScgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLnN0YXRlKCdmYWRlJywgY29yZV8xLnN0eWxlKHsgb3BhY2l0eTogMSB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuc3RhdGUoJ3NsaWRlRG93biwgc2xpZGVVcCcsIGNvcmVfMS5zdHlsZSh7IG9wYWNpdHk6IDEsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMCknIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS50cmFuc2l0aW9uKCd2b2lkID0+IGZseVJpZ2h0JywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoMTAwJSknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLmFuaW1hdGUoJzAuMnMgZWFzZS1pbicpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS50cmFuc2l0aW9uKCdmbHlSaWdodCA9PiB2b2lkJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5hbmltYXRlKCcwLjJzIDEwbXMgZWFzZS1vdXQnLCBjb3JlXzEuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDEwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEudHJhbnNpdGlvbigndm9pZCA9PiBmbHlMZWZ0JywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5zdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTEwMCUpJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5hbmltYXRlKCcwLjJzIGVhc2UtaW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEudHJhbnNpdGlvbignZmx5TGVmdCA9PiB2b2lkJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5hbmltYXRlKCcwLjJzIDEwbXMgZWFzZS1vdXQnLCBjb3JlXzEuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKC0xMDAlKSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLnRyYW5zaXRpb24oJ3ZvaWQgPT4gZmFkZScsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5hbmltYXRlKCcwLjNzIGVhc2UtaW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEudHJhbnNpdGlvbignZmFkZSA9PiB2b2lkJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS5hbmltYXRlKCcwLjNzIDEwbXMgZWFzZS1vdXQnLCBjb3JlXzEuc3R5bGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEudHJhbnNpdGlvbigndm9pZCA9PiBzbGlkZURvd24nLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMjAwJSknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLmFuaW1hdGUoJzAuM3MgZWFzZS1pbicpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS50cmFuc2l0aW9uKCdzbGlkZURvd24gPT4gdm9pZCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuYW5pbWF0ZSgnMC4zcyAxMG1zIGVhc2Utb3V0JywgY29yZV8xLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMjAwJSknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVfMS50cmFuc2l0aW9uKCd2b2lkID0+IHNsaWRlVXAnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgyMDAlKSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuYW5pbWF0ZSgnMC4zcyBlYXNlLWluJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29yZV8xLnRyYW5zaXRpb24oJ3NsaWRlVXAgPT4gdm9pZCcsIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JlXzEuYW5pbWF0ZSgnMC4zcyAxMG1zIGVhc2Utb3V0JywgY29yZV8xLnN0eWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgyMDAlKSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5Ub2FzdENvbnRhaW5lci5jdG9yUGFyYW1ldGVycyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtcbiAgICB7IHR5cGU6IHBsYXRmb3JtX2Jyb3dzZXJfMS5Eb21TYW5pdGl6ZXIsIH0sXG4gICAgeyB0eXBlOiBjb3JlXzEuQ2hhbmdlRGV0ZWN0b3JSZWYsIH0sXG4gICAgeyB0eXBlOiBjb3JlXzEuTmdab25lLCB9LFxuICAgIHsgdHlwZTogdG9hc3Rfb3B0aW9uc18xLlRvYXN0T3B0aW9ucywgfSxcbl07IH07XG5leHBvcnRzLlRvYXN0Q29udGFpbmVyID0gVG9hc3RDb250YWluZXI7XG4iXX0=