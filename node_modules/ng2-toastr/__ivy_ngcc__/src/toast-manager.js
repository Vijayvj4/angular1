"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var toast_container_component_1 = require("./toast-container.component");
var toast_options_1 = require("./toast-options");
var toast_1 = require("./toast");
var Subject_1 = require("rxjs/Subject");
var ɵngcc0 = require('@angular/core');
var ɵngcc1 = require('./toast-options');
var ToastsManager = (function () {
    function ToastsManager(componentFactoryResolver, ngZone, appRef, options) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.ngZone = ngZone;
        this.appRef = appRef;
        this.options = options;
        this.index = 0;
        this.toastClicked = new Subject_1.Subject();
    }
    ToastsManager.prototype.setRootViewContainerRef = function (vRef) {
        this._rootViewContainerRef = vRef;
    };
    ToastsManager.prototype.onClickToast = function () {
        return this.toastClicked.asObservable();
    };
    ToastsManager.prototype.show = function (toast, options) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            if (!_this.container) {
                // get app root view component ref
                if (!_this._rootViewContainerRef) {
                    try {
                        _this._rootViewContainerRef = _this.appRef['_rootComponents'][0]['_hostElement'].vcRef;
                    }
                    catch (e) {
                        reject(new Error('Please set root ViewContainerRef using setRootViewContainerRef(vRef: ViewContainerRef) method.'));
                    }
                }
                // get options providers
                var providers = core_1.ReflectiveInjector.resolve([
                    { provide: toast_options_1.ToastOptions, useValue: _this.options }
                ]);
                // create and load ToastContainer
                var toastFactory = _this.componentFactoryResolver.resolveComponentFactory(toast_container_component_1.ToastContainer);
                var childInjector = core_1.ReflectiveInjector.fromResolvedProviders(providers, _this._rootViewContainerRef.parentInjector);
                _this.container = _this._rootViewContainerRef.createComponent(toastFactory, _this._rootViewContainerRef.length, childInjector);
                _this.container.instance.onToastClicked = function (toast) {
                    _this._onToastClicked(toast);
                };
                _this.container.instance.onExit().subscribe(function () {
                    _this.dispose();
                });
            }
            resolve(_this.setupToast(toast, options));
        });
    };
    ToastsManager.prototype.createTimeout = function (toast) {
        var _this = this;
        var task;
        this.ngZone.runOutsideAngular(function () {
            task = setTimeout(function () { return _this.ngZone.run(function () { return _this.clearToast(toast); }); }, toast.config.toastLife);
        });
        return task.toString();
    };
    ToastsManager.prototype.setupToast = function (toast, options) {
        toast.id = ++this.index;
        if (options && options.hasOwnProperty('toastLife')) {
            options.dismiss = 'auto';
        }
        var customConfig = Object.assign({}, this.options, options || {});
        Object.keys(toast.config).forEach(function (k) {
            if (customConfig.hasOwnProperty(k)) {
                toast.config[k] = customConfig[k];
            }
        });
        if (toast.config.dismiss === 'auto') {
            toast.timeoutId = this.createTimeout(toast);
        }
        this.container.instance.addToast(toast);
        return toast;
    };
    ToastsManager.prototype._onToastClicked = function (toast) {
        this.toastClicked.next(toast);
        if (toast.config.dismiss === 'click') {
            this.clearToast(toast);
        }
    };
    ToastsManager.prototype.dismissToast = function (toast) {
        this.clearToast(toast);
    };
    ToastsManager.prototype.clearToast = function (toast) {
        if (this.container) {
            var instance = this.container.instance;
            instance.removeToast(toast);
        }
    };
    ToastsManager.prototype.clearAllToasts = function () {
        if (this.container) {
            var instance = this.container.instance;
            instance.removeAllToasts();
            this.dispose();
        }
    };
    ToastsManager.prototype.dispose = function () {
        if (this.container) {
            this.container.destroy();
            this.container = null;
        }
    };
    ToastsManager.prototype.error = function (message, title, options) {
        var data = options && options.data ? options.data : null;
        var toast = new toast_1.Toast('error', message, title, data);
        return this.show(toast, options);
    };
    ToastsManager.prototype.info = function (message, title, options) {
        var data = options && options.data ? options.data : null;
        var toast = new toast_1.Toast('info', message, title, data);
        return this.show(toast, options);
    };
    ToastsManager.prototype.success = function (message, title, options) {
        var data = options && options.data ? options.data : null;
        var toast = new toast_1.Toast('success', message, title, data);
        return this.show(toast, options);
    };
    ToastsManager.prototype.warning = function (message, title, options) {
        var data = options && options.data ? options.data : null;
        var toast = new toast_1.Toast('warning', message, title, data);
        return this.show(toast, options);
    };
    // allow user define custom background color and image
    ToastsManager.prototype.custom = function (message, title, options) {
        var data = options && options.data ? options.data : null;
        var toast = new toast_1.Toast('custom', message, title, data);
        return this.show(toast, options);
    };
ToastsManager.ɵfac = function ToastsManager_Factory(t) { return new (t || ToastsManager)(ɵngcc0.ɵɵinject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵinject(ɵngcc0.NgZone), ɵngcc0.ɵɵinject(ɵngcc0.ApplicationRef), ɵngcc0.ɵɵinject(ɵngcc1.ToastOptions)); };
ToastsManager.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: ToastsManager, factory: function (t) { return ToastsManager.ɵfac(t); } });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ToastsManager, [{
        type: core_1.Injectable
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.ApplicationRef }, { type: ɵngcc1.ToastOptions }]; }, null); })();
    return ToastsManager;
}());
/** @nocollapse */
ToastsManager.ctorParameters = function () { return [
    { type: core_1.ComponentFactoryResolver, },
    { type: core_1.NgZone, },
    { type: core_1.ApplicationRef, },
    { type: toast_options_1.ToastOptions, },
]; };
exports.ToastsManager = ToastsManager;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9hc3QtbWFuYWdlci5qcyIsInNvdXJjZXMiOlsidG9hc3QtbWFuYWdlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7a0xBQU07QUFDTjtBQUNBLEtBR0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBjb3JlXzEgPSByZXF1aXJlKFwiQGFuZ3VsYXIvY29yZVwiKTtcbnZhciB0b2FzdF9jb250YWluZXJfY29tcG9uZW50XzEgPSByZXF1aXJlKFwiLi90b2FzdC1jb250YWluZXIuY29tcG9uZW50XCIpO1xudmFyIHRvYXN0X29wdGlvbnNfMSA9IHJlcXVpcmUoXCIuL3RvYXN0LW9wdGlvbnNcIik7XG52YXIgdG9hc3RfMSA9IHJlcXVpcmUoXCIuL3RvYXN0XCIpO1xudmFyIFN1YmplY3RfMSA9IHJlcXVpcmUoXCJyeGpzL1N1YmplY3RcIik7XG52YXIgVG9hc3RzTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVG9hc3RzTWFuYWdlcihjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIG5nWm9uZSwgYXBwUmVmLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyID0gY29tcG9uZW50RmFjdG9yeVJlc29sdmVyO1xuICAgICAgICB0aGlzLm5nWm9uZSA9IG5nWm9uZTtcbiAgICAgICAgdGhpcy5hcHBSZWYgPSBhcHBSZWY7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuaW5kZXggPSAwO1xuICAgICAgICB0aGlzLnRvYXN0Q2xpY2tlZCA9IG5ldyBTdWJqZWN0XzEuU3ViamVjdCgpO1xuICAgIH1cbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5zZXRSb290Vmlld0NvbnRhaW5lclJlZiA9IGZ1bmN0aW9uICh2UmVmKSB7XG4gICAgICAgIHRoaXMuX3Jvb3RWaWV3Q29udGFpbmVyUmVmID0gdlJlZjtcbiAgICB9O1xuICAgIFRvYXN0c01hbmFnZXIucHJvdG90eXBlLm9uQ2xpY2tUb2FzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9hc3RDbGlja2VkLmFzT2JzZXJ2YWJsZSgpO1xuICAgIH07XG4gICAgVG9hc3RzTWFuYWdlci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICh0b2FzdCwgb3B0aW9ucykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5jb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBnZXQgYXBwIHJvb3QgdmlldyBjb21wb25lbnQgcmVmXG4gICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5fcm9vdFZpZXdDb250YWluZXJSZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9yb290Vmlld0NvbnRhaW5lclJlZiA9IF90aGlzLmFwcFJlZlsnX3Jvb3RDb21wb25lbnRzJ11bMF1bJ19ob3N0RWxlbWVudCddLnZjUmVmO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdQbGVhc2Ugc2V0IHJvb3QgVmlld0NvbnRhaW5lclJlZiB1c2luZyBzZXRSb290Vmlld0NvbnRhaW5lclJlZih2UmVmOiBWaWV3Q29udGFpbmVyUmVmKSBtZXRob2QuJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGdldCBvcHRpb25zIHByb3ZpZGVyc1xuICAgICAgICAgICAgICAgIHZhciBwcm92aWRlcnMgPSBjb3JlXzEuUmVmbGVjdGl2ZUluamVjdG9yLnJlc29sdmUoW1xuICAgICAgICAgICAgICAgICAgICB7IHByb3ZpZGU6IHRvYXN0X29wdGlvbnNfMS5Ub2FzdE9wdGlvbnMsIHVzZVZhbHVlOiBfdGhpcy5vcHRpb25zIH1cbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgYW5kIGxvYWQgVG9hc3RDb250YWluZXJcbiAgICAgICAgICAgICAgICB2YXIgdG9hc3RGYWN0b3J5ID0gX3RoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KHRvYXN0X2NvbnRhaW5lcl9jb21wb25lbnRfMS5Ub2FzdENvbnRhaW5lcik7XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkSW5qZWN0b3IgPSBjb3JlXzEuUmVmbGVjdGl2ZUluamVjdG9yLmZyb21SZXNvbHZlZFByb3ZpZGVycyhwcm92aWRlcnMsIF90aGlzLl9yb290Vmlld0NvbnRhaW5lclJlZi5wYXJlbnRJbmplY3Rvcik7XG4gICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyID0gX3RoaXMuX3Jvb3RWaWV3Q29udGFpbmVyUmVmLmNyZWF0ZUNvbXBvbmVudCh0b2FzdEZhY3RvcnksIF90aGlzLl9yb290Vmlld0NvbnRhaW5lclJlZi5sZW5ndGgsIGNoaWxkSW5qZWN0b3IpO1xuICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5pbnN0YW5jZS5vblRvYXN0Q2xpY2tlZCA9IGZ1bmN0aW9uICh0b2FzdCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fb25Ub2FzdENsaWNrZWQodG9hc3QpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmluc3RhbmNlLm9uRXhpdCgpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoX3RoaXMuc2V0dXBUb2FzdCh0b2FzdCwgb3B0aW9ucykpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFRvYXN0c01hbmFnZXIucHJvdG90eXBlLmNyZWF0ZVRpbWVvdXQgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHRhc2s7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRhc2sgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLm5nWm9uZS5ydW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuY2xlYXJUb2FzdCh0b2FzdCk7IH0pOyB9LCB0b2FzdC5jb25maWcudG9hc3RMaWZlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0YXNrLnRvU3RyaW5nKCk7XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5zZXR1cFRvYXN0ID0gZnVuY3Rpb24gKHRvYXN0LCBvcHRpb25zKSB7XG4gICAgICAgIHRvYXN0LmlkID0gKyt0aGlzLmluZGV4O1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KCd0b2FzdExpZmUnKSkge1xuICAgICAgICAgICAgb3B0aW9ucy5kaXNtaXNzID0gJ2F1dG8nO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjdXN0b21Db25maWcgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMgfHwge30pO1xuICAgICAgICBPYmplY3Qua2V5cyh0b2FzdC5jb25maWcpLmZvckVhY2goZnVuY3Rpb24gKGspIHtcbiAgICAgICAgICAgIGlmIChjdXN0b21Db25maWcuaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgICAgICAgICB0b2FzdC5jb25maWdba10gPSBjdXN0b21Db25maWdba107XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodG9hc3QuY29uZmlnLmRpc21pc3MgPT09ICdhdXRvJykge1xuICAgICAgICAgICAgdG9hc3QudGltZW91dElkID0gdGhpcy5jcmVhdGVUaW1lb3V0KHRvYXN0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbnRhaW5lci5pbnN0YW5jZS5hZGRUb2FzdCh0b2FzdCk7XG4gICAgICAgIHJldHVybiB0b2FzdDtcbiAgICB9O1xuICAgIFRvYXN0c01hbmFnZXIucHJvdG90eXBlLl9vblRvYXN0Q2xpY2tlZCA9IGZ1bmN0aW9uICh0b2FzdCkge1xuICAgICAgICB0aGlzLnRvYXN0Q2xpY2tlZC5uZXh0KHRvYXN0KTtcbiAgICAgICAgaWYgKHRvYXN0LmNvbmZpZy5kaXNtaXNzID09PSAnY2xpY2snKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyVG9hc3QodG9hc3QpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5kaXNtaXNzVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgdGhpcy5jbGVhclRvYXN0KHRvYXN0KTtcbiAgICB9O1xuICAgIFRvYXN0c01hbmFnZXIucHJvdG90eXBlLmNsZWFyVG9hc3QgPSBmdW5jdGlvbiAodG9hc3QpIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbmVyKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzLmNvbnRhaW5lci5pbnN0YW5jZTtcbiAgICAgICAgICAgIGluc3RhbmNlLnJlbW92ZVRvYXN0KHRvYXN0KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RzTWFuYWdlci5wcm90b3R5cGUuY2xlYXJBbGxUb2FzdHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcy5jb250YWluZXIuaW5zdGFuY2U7XG4gICAgICAgICAgICBpbnN0YW5jZS5yZW1vdmVBbGxUb2FzdHMoKTtcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5jb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVG9hc3RzTWFuYWdlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBvcHRpb25zICYmIG9wdGlvbnMuZGF0YSA/IG9wdGlvbnMuZGF0YSA6IG51bGw7XG4gICAgICAgIHZhciB0b2FzdCA9IG5ldyB0b2FzdF8xLlRvYXN0KCdlcnJvcicsIG1lc3NhZ2UsIHRpdGxlLCBkYXRhKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvdyh0b2FzdCwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkYXRhID0gb3B0aW9ucyAmJiBvcHRpb25zLmRhdGEgPyBvcHRpb25zLmRhdGEgOiBudWxsO1xuICAgICAgICB2YXIgdG9hc3QgPSBuZXcgdG9hc3RfMS5Ub2FzdCgnaW5mbycsIG1lc3NhZ2UsIHRpdGxlLCBkYXRhKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvdyh0b2FzdCwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5zdWNjZXNzID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkYXRhID0gb3B0aW9ucyAmJiBvcHRpb25zLmRhdGEgPyBvcHRpb25zLmRhdGEgOiBudWxsO1xuICAgICAgICB2YXIgdG9hc3QgPSBuZXcgdG9hc3RfMS5Ub2FzdCgnc3VjY2VzcycsIG1lc3NhZ2UsIHRpdGxlLCBkYXRhKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvdyh0b2FzdCwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS53YXJuaW5nID0gZnVuY3Rpb24gKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBkYXRhID0gb3B0aW9ucyAmJiBvcHRpb25zLmRhdGEgPyBvcHRpb25zLmRhdGEgOiBudWxsO1xuICAgICAgICB2YXIgdG9hc3QgPSBuZXcgdG9hc3RfMS5Ub2FzdCgnd2FybmluZycsIG1lc3NhZ2UsIHRpdGxlLCBkYXRhKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2hvdyh0b2FzdCwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICAvLyBhbGxvdyB1c2VyIGRlZmluZSBjdXN0b20gYmFja2dyb3VuZCBjb2xvciBhbmQgaW1hZ2VcbiAgICBUb2FzdHNNYW5hZ2VyLnByb3RvdHlwZS5jdXN0b20gPSBmdW5jdGlvbiAobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBvcHRpb25zICYmIG9wdGlvbnMuZGF0YSA/IG9wdGlvbnMuZGF0YSA6IG51bGw7XG4gICAgICAgIHZhciB0b2FzdCA9IG5ldyB0b2FzdF8xLlRvYXN0KCdjdXN0b20nLCBtZXNzYWdlLCB0aXRsZSwgZGF0YSk7XG4gICAgICAgIHJldHVybiB0aGlzLnNob3codG9hc3QsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgcmV0dXJuIFRvYXN0c01hbmFnZXI7XG59KCkpO1xuVG9hc3RzTWFuYWdlci5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogY29yZV8xLkluamVjdGFibGUgfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cblRvYXN0c01hbmFnZXIuY3RvclBhcmFtZXRlcnMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBbXG4gICAgeyB0eXBlOiBjb3JlXzEuQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLCB9LFxuICAgIHsgdHlwZTogY29yZV8xLk5nWm9uZSwgfSxcbiAgICB7IHR5cGU6IGNvcmVfMS5BcHBsaWNhdGlvblJlZiwgfSxcbiAgICB7IHR5cGU6IHRvYXN0X29wdGlvbnNfMS5Ub2FzdE9wdGlvbnMsIH0sXG5dOyB9O1xuZXhwb3J0cy5Ub2FzdHNNYW5hZ2VyID0gVG9hc3RzTWFuYWdlcjtcbiJdfQ==